<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Presentation Generator</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">

    <!-- Inline Tailwind CSS Configuration -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#0052CC',
              secondary: '#00A3BF',
              neutral: {
                light: '#F5F5F5',
                DEFAULT: '#E0E0E0',
                dark: '#757575',
              },
              success: '#4CAF50',
              error: '#F44336',
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              serif: ['Merriweather', 'serif'],
            }
          }
        }
      }
    </script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tailwind CSS Directives -->
    <style type="text/tailwindcss">
      @tailwind base;
      @tailwind components;
      @tailwind utilities;
      body {
        font-family: theme('fontFamily.sans');
        color: theme('colors.neutral.dark');
        background-color: theme('colors.neutral.light');
      }
      /* Add more global base styles if needed */
    </style>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- React Router DOM -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-router-dom/6.23.1/react-router-dom.development.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.js"></script>

    <!-- react-chartjs-2 -->
    <script src="https://cdn.jsdelivr.net/npm/react-chartjs-2@5.2.0/dist/react-chartjs-2.min.js"></script>

    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

</head>
<body>
    <div id="root"></div>

    <!-- Main React Script Tag -->
    <script type="text/babel" data-type="module" id="app-script">
// /**
//  * @typedef {Object} Property
//  * @property {string} id
//  * @property {string} title
//  * @property {string} address
//  * @property {string} neighborhood
//  * @property {number} price
//  * @property {number} bedrooms
//  * @property {number} bathrooms
//  * @property {number} area
//  * @property {string} type
//  * @property {string} description
//  * @property {string[]} features
//  * @property {string[]} images
//  * @property {number} latitude
//  * @property {number} longitude
//  * @property {Amenity[]} amenities
//  * @property {number} [beachDistance] // Optional
//  * @property {string} [portalName] // Optional: e.g., "Vila Vix Imóveis"
//  */

// /**
//  * @typedef {Object} Amenity
//  * @property {string} name
//  * @property {string} type // e.g., "pharmacy", "gym", "supermarket"
//  * @property {string} distance // e.g., "500m", "1.2km" (derived)
//  * @property {string} address // (from Google Places)
//  * @property {number} latitude // (from Google Places)
//  * @property {number} longitude // (from Google Places)
//  * @property {string} [iconUrl] // Optional: URL for a custom icon
//  */

const { HashRouter, Routes, Route, Link, useParams, useNavigate } = ReactRouterDOM;

const propertyService = {
  fetchSelicRate: async () => {
    const apiUrl = 'https://api.bcb.gov.br/dados/serie/bcdata.sgs.11/dados/ultimos/1?formato=json';
    // It's better to encode the target URL if it's being passed as a query parameter to the proxy.
    const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(apiUrl)}`;
    try {
      const response = await fetch(proxyUrl);
      if (!response.ok) {
        // Log the HTTP status for more context on the error
        console.warn(`Failed to fetch SELIC rate. HTTP status: ${response.status}. Using fallback.`);
        return 0.105; // Fallback rate
      }
      const data = await response.json();
      if (data && data.length > 0 && data[0].valor !== undefined) {
        const rate = parseFloat(String(data[0].valor).replace(',', '.')); // Ensure decimal is dot
        if (isNaN(rate)) {
          console.warn('Failed to parse SELIC rate value. Using fallback.', data[0].valor);
          return 0.105;
        }
        return rate / 100;
      } else {
        console.warn('Unexpected data format from SELIC API. Using fallback.', data);
        return 0.105; // Fallback rate for unexpected data structure
      }
    } catch (error) {
      console.warn('Failed to fetch SELIC rate due to a network or parsing error. Using fallback.', error);
      return 0.105; // Fallback rate for network errors or other issues
    }
  },

  extractPropertyData: async (url) => {
    if (!url || typeof url !== 'string' || !url.includes('vilaviximoveis.com.br')) {
      throw new Error("URL inválida. Certifique-se de que é um link de vilaviximoveis.com.br.");
    }

    try {
      console.log(`Simulating data extraction for: ${url}`);
      await new Promise(resolve => setTimeout(resolve, 1500)); // Simulate 1.5-second delay

      const mockProperty = {
        id: "mockProperty123",
        title: "Área de Terra Mock em Pendanga, Ibiraçu",
        address: "Rua das Palmeiras, 123, Pendanga, Ibiraçu, ES",
        neighborhood: "Pendanga",
        price: 1200000,
        bedrooms: 0,
        bathrooms: 0,
        area: 30000,
        type: "Área de Terra",
        description: "Esta é uma descrição mock de uma bela área de terra localizada em Pendanga, Ibiraçu. Ideal para desenvolvimento ou investimento. Possui vasta vegetação e fácil acesso.",
        features: ["Vista para Montanha", "Próximo a Rio", "Documentação OK"],
        images: [
          "https://via.placeholder.com/800x600.png?text=Imagem+Principal+Mock+1",
          "https://via.placeholder.com/400x300.png?text=Thumbnail+Mock+2",
          "https://via.placeholder.com/400x300.png?text=Thumbnail+Mock+3"
        ],
        latitude: -19.8358, // Mock coordinates for Ibiraçu
        longitude: -40.3721, // Mock coordinates for Ibiraçu
        amenities: [], // Empty for now, as per JSDoc and common sense for "Área de Terra"
        beachDistance: null, // Explicitly null as it's an area, not typically beach-front by default. Could be a number (km) if relevant.
        portalName: "Vila Vix Imóveis (Mock)"
      };

      console.log("Returning mock property data:", mockProperty);
      return mockProperty;
    } catch (error) {
      console.error("Error during mock data extraction:", error);
      // Re-throw a generic error to the caller, masking internal details if necessary
      throw new Error("Erro ao processar dados do imóvel.");
    }
  }
  // fetchNearbyAmenities will be added here.
};

// Example usage (for testing in console):
// propertyService.fetchSelicRate().then(rate => console.log('SELIC Rate:', rate));

const HomePage = () => {
  const [url, setUrl] = React.useState('');
  const [isLoading, setIsLoading] = React.useState(false);
  const [error, setError] = React.useState('');
  const navigate = useNavigate(); // Added for navigation

  const handleGenerate = async () => { // Made async
    if (!url.trim()) {
      setError('Por favor, insira uma URL válida.');
      return;
    }
    if (!url.includes('vilaviximoveis.com.br')) {
      setError('Por favor, insira uma URL válida do portal Vila Vix Imóveis.');
      return;
    }
    setError('');
    setIsLoading(true);
    console.log('Solicitando geração de apresentação para:', url);

    try {
      const propertyData = await propertyService.extractPropertyData(url);
      console.log('Mock property data received:', propertyData);
      // Navigate after successful "fetch"
      if (propertyData && propertyData.id) {
        navigate(`/presentation/${propertyData.id}`); // Use ID from mock data
      } else {
        console.error('Property data or ID is missing.');
        setError('Não foi possível obter os dados do imóvel para navegação.');
      }
    } catch (err) {
      console.error("Error during property data fetching or navigation:", err);
      setError(err.message || 'Falha ao buscar dados do imóvel ou ao navegar.');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    React.createElement('div', { className: 'min-h-screen bg-neutral-light flex flex-col items-center justify-center p-4 sm:p-8' },
      React.createElement('div', { className: 'w-full max-w-2xl' },
        React.createElement('header', { className: 'text-center mb-10' },
          React.createElement('h1', { className: 'text-4xl sm:text-5xl font-bold text-primary mb-3 font-serif' }, 'Gerador de Apresentação Imobiliária'),
          React.createElement('p', { className: 'text-lg text-neutral-dark font-sans' }, 'Transforme anúncios do Vila Vix Imóveis em apresentações interativas e profissionais.')
        ),

        React.createElement('main', { className: 'bg-white p-6 sm:p-8 rounded-xl shadow-2xl mb-12' },
          React.createElement('div', { className: 'space-y-6' },
            React.createElement('div', null,
              React.createElement('label', { htmlFor: 'urlInput', className: 'block text-sm font-medium text-neutral-dark mb-1 font-sans' }, 'URL do Anúncio'),
              React.createElement('input', {
                type: 'text',
                id: 'urlInput',
                value: url,
                onChange: (e) => setUrl(e.target.value),
                placeholder: 'Cole a URL do anúncio aqui (ex: www.vilaviximoveis.com.br/...)',
                className: 'w-full px-4 py-3 border border-neutral rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-shadow duration-200 ease-in-out font-sans text-sm',
                disabled: isLoading
              })
            ),
            error && React.createElement('p', { className: 'text-sm text-error bg-red-100 p-3 rounded-md font-sans' }, error),
            isLoading
              ? React.createElement('div', { className: 'flex items-center justify-center text-primary py-3' },
                  React.createElement('div', { className: 'animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-primary mr-3' }),
                  React.createElement('p', { className: 'font-sans text-lg' }, 'Carregando... Aguarde um instante.')
                )
              : React.createElement('button', {
                  onClick: handleGenerate,
                  disabled: isLoading,
                  className: 'w-full bg-primary hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50 disabled:opacity-60 disabled:cursor-not-allowed font-sans text-lg'
                },
                'Gerar Apresentação'
              )
          )
        ),

        React.createElement('section', { className: 'text-center' },
          React.createElement('h2', { className: 'text-2xl sm:text-3xl font-semibold text-primary mb-6 font-serif' }, 'Recursos Principais'),
          React.createElement('ul', { className: 'space-y-3 text-neutral-dark max-w-md mx-auto font-sans' },
            ['Detalhes Instantâneos do Imóvel', 'Mapa Interativo de Comodidades Próximas', 'Projeções Financeiras e Comparativos', 'Scraping de Dados em Tempo Real'].map((feature, index) =>
              React.createElement('li', { key: index, className: 'p-3 bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 ease-in-out' },
                 React.createElement('span', {className: 'text-secondary font-bold'}, '✓ '), feature
              )
            )
          )
        )
      )
    )
  );
};

const PropertyDetails = ({ property }) => {
  const [mainImage, setMainImage] = React.useState(
    property && property.images && property.images.length > 0 
      ? property.images[0] 
      : 'https://via.placeholder.com/800x600.png?text=Imagem+Indisponível'
  );

  // Helper to format price
  const formatPrice = (price) => {
    if (price === undefined || price === null || price === 0) return 'Preço a consultar';
    return price.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
  };
  
  // Helper for bedrooms/bathrooms - pluralizes label
  const formatNumericDetail = (value, singularLabel, pluralLabel) => {
    if (property.type === "Área de Terra" && (singularLabel === 'Quarto' || singularLabel === 'Banheiro')) return 'N/A (Área de Terra)';
    if (typeof value === 'number' && value > 0) return `${value} ${value === 1 ? singularLabel : (pluralLabel || singularLabel + 's')}`;
    return 'Não informado';
  };

  // --- Image Gallery Elements ---
  const imageGallery = React.createElement('div', { className: 'mb-6' },
    React.createElement('img', { 
      src: mainImage, 
      alt: 'Imagem Principal do Imóvel', 
      className: 'w-full h-auto max-h-[500px] object-cover rounded-lg shadow-lg mb-4 border border-neutral' 
    }),
    property.images && property.images.length > 1 // Only show thumbnails if more than one image
      ? React.createElement('div', { className: 'flex space-x-2 overflow-x-auto pb-2' },
          property.images.map((image, index) => 
            React.createElement('img', {
              key: index,
              src: image,
              alt: `Thumbnail ${index + 1}`,
              onClick: () => setMainImage(image),
              className: `w-24 h-20 object-cover rounded-md cursor-pointer border-2 hover:border-primary transition-all duration-200 ${mainImage === image ? 'border-primary' : 'border-neutral-light'}`
            })
          )
        )
      : null
  );

  // --- Info Pills/Cards Section Elements ---
  const infoPillsData = [
    { label: 'Preço', value: formatPrice(property.price), className: 'text-success font-bold text-xl' },
    { label: 'Endereço Completo', value: property.address || 'Não informado' },
    { label: 'Tipo', value: property.type || 'Não informado' },
    { label: 'Área Útil', value: property.area ? `${property.area} m²` : 'Não informada' },
    { label: 'Quartos', value: formatNumericDetail(property.bedrooms, 'Quarto', 'Quartos') },
    { label: 'Banheiros', value: formatNumericDetail(property.bathrooms, 'Banheiro', 'Banheiros') },
  ];

  const infoPillsSection = React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6' },
    infoPillsData.map((pill, index) => 
      React.createElement('div', { key: index, className: 'bg-white p-4 rounded-lg shadow-md border border-neutral' },
        React.createElement('h4', { className: 'text-sm font-semibold text-primary mb-1 font-sans' }, pill.label),
        React.createElement('p', { className: `text-neutral-dark font-sans ${pill.className || ''}` }, pill.value)
      )
    )
  );

  // --- Descrição Detalhada Section Elements ---
  const descriptionSection = React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow-md border border-neutral mb-6' },
    React.createElement('h3', { className: 'text-xl font-semibold text-primary mb-3 font-serif' }, 'Descrição Detalhada'),
    React.createElement('p', { className: 'text-neutral-dark font-sans leading-relaxed whitespace-pre-line' }, 
      property.description || 'Descrição não disponível.'
    )
  );

  // --- Características Section Elements ---
  const featuresSection = React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow-md border border-neutral' },
    React.createElement('h3', { className: 'text-xl font-semibold text-primary mb-3 font-serif' }, 'Características Adicionais'),
    property.features && property.features.length > 0
      ? React.createElement('ul', { className: 'list-disc list-inside space-y-1 text-neutral-dark font-sans' },
          property.features.map((feature, index) => 
            React.createElement('li', { key: index }, feature)
          )
        )
      : React.createElement('p', { className: 'text-neutral-dark font-sans' }, 'Nenhuma característica adicional listada.')
  );

  return React.createElement('div', { className: 'space-y-6 py-4' },
    imageGallery,
    infoPillsSection,
    descriptionSection,
    featuresSection
  );
};

const PresentationPage = () => {
  const { propertyId } = useParams();
  const [propertyData, setPropertyData] = React.useState(null);
  const [isLoading, setIsLoading] = React.useState(true);
  const [error, setError] = React.useState('');
  const [activeTab, setActiveTab] = React.useState('visaoGeral'); // 'visaoGeral', 'vizinhanca', 'projecao'

  React.useEffect(() => {
    const fetchData = async () => {
      setIsLoading(true);
      setError('');
      try {
        // Construct a valid-looking mock URL for the service
        const mockUrl = `https://www.vilaviximoveis.com.br/imovel/${propertyId}`; // propertyId is used here
        const data = await propertyService.extractPropertyData(mockUrl);
        setPropertyData(data);
      } catch (err) {
        console.error("Error fetching property data for presentation:", err);
        setError(`Falha ao carregar dados do imóvel para apresentação: ${err.message}`);
      } finally {
        setIsLoading(false);
      }
    };
    if (propertyId) { // Ensure propertyId is available before fetching
        fetchData();
    } else {
        setError('ID do imóvel não fornecido.');
        setIsLoading(false);
    }
  }, [propertyId]);

  if (isLoading) {
    return React.createElement('div', { className: 'p-8 text-center text-lg font-sans text-neutral-dark' }, 'Carregando dados da apresentação...');
  }

  if (error) {
    return React.createElement('div', { className: 'p-8 text-center text-error bg-red-100 rounded-lg shadow-md' }, 
      React.createElement('p', {className: 'font-semibold text-lg mb-2'}, 'Erro ao Carregar Apresentação'),
      React.createElement('p', {className: 'text-sm'}, error)
    );
  }
  
  if (!propertyData) {
    return React.createElement('div', { className: 'p-8 text-center text-lg font-sans text-neutral-dark' }, 'Dados do imóvel não encontrados.');
  }

  const header = React.createElement('header', { className: 'bg-white shadow-lg p-6 rounded-lg mb-8' },
    React.createElement('div', { className: 'flex flex-col md:flex-row justify-between items-start md:items-center' },
      React.createElement('div', { className: 'mb-4 md:mb-0' },
        React.createElement('h1', { className: 'text-3xl md:text-4xl font-bold text-primary font-serif mb-1' }, propertyData.title),
        React.createElement('p', { className: 'text-md text-neutral-dark font-sans' }, propertyData.address)
      ),
      React.createElement('div', { className: 'flex space-x-3' },
        React.createElement('button', {
          onClick: () => alert('Compartilhar clicado!'),
          className: 'bg-secondary hover:bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-300 ease-in-out shadow-md hover:shadow-lg font-sans'
        }, 'Compartilhar'),
        React.createElement('button', {
          onClick: () => alert('Baixar PDF clicado!'),
          className: 'bg-success hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition-colors duration-300 ease-in-out shadow-md hover:shadow-lg font-sans'
        }, 'Baixar PDF')
      )
    )
  );

  const tabsData = [
    { id: 'visaoGeral', label: 'Visão Geral' },
    { id: 'vizinhanca', label: 'Vizinhança' },
    { id: 'projecao', label: 'Projeção de Valor' }
  ];

  const tabNavigation = React.createElement('nav', { className: 'mb-8 flex justify-center border-b-2 border-neutral' },
    tabsData.map(tab => 
      React.createElement('button', {
        key: tab.id,
        onClick: () => setActiveTab(tab.id),
        className: `pb-2 px-6 font-medium text-lg font-sans focus:outline-none transition-colors duration-200 ease-in-out -mb-px ${activeTab === tab.id 
          ? 'border-b-4 border-primary text-primary' 
          : 'text-neutral-dark hover:text-primary hover:border-primary hover:border-b-4'}`
      }, tab.label)
    )
  );

  let tabContent;
  switch (activeTab) {
    case 'visaoGeral':
      tabContent = React.createElement(PropertyDetails, { property: propertyData });
      break;
    case 'vizinhanca':
      tabContent = React.createElement('div', { className: 'p-6 bg-white rounded-lg shadow' }, 
        React.createElement('h2', {className: 'text-2xl font-semibold text-primary mb-3 font-serif'}, 'Vizinhança'),
        React.createElement('p', {className: 'font-sans text-neutral-dark'}, 'Informações sobre o bairro, mapa interativo, pontos de interesse próximos, etc.')
      );
      break;
    case 'projecao':
      tabContent = React.createElement('div', { className: 'p-6 bg-white rounded-lg shadow' }, 
        React.createElement('h2', {className: 'text-2xl font-semibold text-primary mb-3 font-serif'}, 'Projeção de Valor'),
        React.createElement('p', {className: 'font-sans text-neutral-dark'}, 'Análise de investimento, comparativo com SELIC, projeção de valorização, etc.')
      );
      break;
    default:
      tabContent = React.createElement('div', null, 'Selecione uma aba.');
  }

  return React.createElement('div', { className: 'container mx-auto p-4 sm:p-6 md:p-8 bg-neutral-light min-h-screen' },
    header,
    tabNavigation,
    tabContent,
    React.createElement(Link, { 
      to: '/', 
      className: 'mt-8 inline-block text-primary hover:text-blue-700 font-sans underline transition-colors' 
    }, '← Voltar para a Página Inicial')
  );
};

// Main App component for routing
const App = () => {
  return React.createElement(HashRouter, null,
    React.createElement(Routes, null,
      React.createElement(Route, { path: '/', element: React.createElement(HomePage) }),
      React.createElement(Route, { path: '/presentation/:propertyId', element: React.createElement(PresentationPage) })
    )
  );
};

// Render the App
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(App));
    </script>
</body>
</html>
