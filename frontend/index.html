<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImóvelPro - Gerador de Apresentações Imobiliárias</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Google Maps API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLX3uQZO7MyaJcmPdE5Y8YcB9og9KdTtQ&libraries=marker,places"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif;
        }
        
        /* Gradientes personalizados */
        .gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }
        
        .gradient-secondary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* Animações */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
        
        .animate-pulse-custom {
            animation: pulse 2s ease-in-out infinite;
        }
        
        /* Loading spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-left: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Cards premium */
        .premium-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 
                0 4px 6px rgba(0, 0, 0, 0.05),
                0 10px 15px rgba(0, 0, 0, 0.1);
        }
        
        .premium-card:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 10px 25px rgba(0, 0, 0, 0.1),
                0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        /* Transições suaves */
        .transition-all {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Configuração da API
        const API_URL = 'http://localhost:3001';
        
        // ==================== SERVIÇOS ====================
        
        const propertyService = {
            // Função real de scraping via backend
            async extractPropertyData(url) {
                try {
                    const response = await fetch(`${API_URL}/api/scrape`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ url })
                    });
                    
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error || 'Erro ao processar imóvel');
                    }
                    
                    const result = await response.json();
                    return result.data;
                    
                } catch (error) {
                    console.error('Erro ao extrair dados:', error);
                    throw error;
                }
            },
            
            // Buscar taxa SELIC
            async fetchSelicRate() {
                try {
                    const response = await fetch(`${API_URL}/api/selic`);
                    const data = await response.json();
                    return data.rate || 11.75;
                } catch (error) {
                    console.warn('Erro ao buscar taxa SELIC:', error);
                    return 11.75;
                }
            }
        };
        
        // ==================== COMPONENTES BASE ====================
        
        const Icon = ({ name, className = "w-6 h-6", ...props }) => {
            const icons = {
                home: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                    </svg>
                ),
                search: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                ),
                mapPin: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                ),
                eye: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                ),
                trendingUp: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                    </svg>
                ),
                bed: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 14v3m4-3v3m4-3v3M3 21h18M3 10h18M3 7l9-4 9 4M4 10h16v11H4V10z" />
                    </svg>
                ),
                bath: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7v2m0 0v2m0-2h8m-8 0a2 2 0 100-4 2 2 0 000 4zm0 0v6m0 0v2m0-2h8m-8 0a2 2 0 100 4 2 2 0 000-4zm8-6v2m0 0v2m0-2a2 2 0 100-4 2 2 0 000 4zm0 0v6m0 0v2m0-2a2 2 0 100 4 2 2 0 000-4z" />
                    </svg>
                ),
                area: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                    </svg>
                ),
                share: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z" />
                    </svg>
                ),
                download: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                ),
                waves: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                    </svg>
                ),
                filter: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                    </svg>
                ),
                alert: (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                )
            };
            
            return icons[name] || null;
        };
        
        // Header
        const Header = () => {
            return (
                <header className="glass backdrop-blur-xl border-b border-white/10 fixed w-full top-0 z-50">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex justify-between items-center h-20">
                            <div className="flex items-center">
                                <Icon name="home" className="w-10 h-10 text-purple-600" />
                                <span className="text-2xl font-bold text-gray-900 ml-3">
                                    Imóvel<span className="text-purple-600">Pro</span>
                                </span>
                            </div>
                            <nav className="hidden md:flex space-x-8">
                                <a href="#" className="text-gray-700 hover:text-purple-600 transition-colors">
                                    Início
                                </a>
                                <a href="#" className="text-gray-700 hover:text-purple-600 transition-colors">
                                    Como Funciona
                                </a>
                                <a href="#" className="text-gray-700 hover:text-purple-600 transition-colors">
                                    Contato
                                </a>
                            </nav>
                        </div>
                    </div>
                </header>
            );
        };
        
        // Footer
        const Footer = () => {
            return (
                <footer className="bg-gray-900 text-white">
                    <div className="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
                        <div className="text-center">
                            <p>© 2025 ImóvelPro. Todos os direitos reservados.</p>
                        </div>
                    </div>
                </footer>
            );
        };
        
        // ==================== PÁGINA INICIAL ====================
        
        const HomePage = ({ onNavigate }) => {
            const [url, setUrl] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');
            const [apiStatus, setApiStatus] = useState('checking');
            
            // Verificar status da API ao montar componente
            useEffect(() => {
                checkApiStatus();
            }, []);
            
            const checkApiStatus = async () => {
                try {
                    const response = await fetch(`${API_URL}/api/health`);
                    if (response.ok) {
                        setApiStatus('online');
                    } else {
                        setApiStatus('offline');
                    }
                } catch (error) {
                    setApiStatus('offline');
                }
            };
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                
                if (!url.trim()) {
                    setError('Por favor, insira uma URL válida');
                    return;
                }
                
                if (!url.includes('vilaviximoveis.com.br')) {
                    setError('Por favor, insira uma URL do Vila Vix Imóveis');
                    return;
                }
                
                setIsLoading(true);
                setError('');
                
                try {
                    const propertyData = await propertyService.extractPropertyData(url);
                    onNavigate('presentation', propertyData);
                } catch (err) {
                    setError(err.message || 'Erro ao processar a URL. Verifique se o servidor está rodando.');
                    console.error('Erro:', err);
                } finally {
                    setIsLoading(false);
                }
            };
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-50 to-blue-50">
                    <Header />
                    
                    <main className="pt-32 pb-20">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            {/* Status da API */}
                            {apiStatus !== 'online' && (
                                <div className="mb-8">
                                    <div className={`p-4 rounded-lg ${apiStatus === 'offline' ? 'bg-red-100 border border-red-400' : 'bg-yellow-100 border border-yellow-400'}`}>
                                        <div className="flex items-center">
                                            <Icon name="alert" className={`w-5 h-5 mr-2 ${apiStatus === 'offline' ? 'text-red-600' : 'text-yellow-600'}`} />
                                            <p className={`text-sm ${apiStatus === 'offline' ? 'text-red-700' : 'text-yellow-700'}`}>
                                                {apiStatus === 'checking' 
                                                    ? 'Verificando conexão com o servidor...' 
                                                    : 'Servidor offline. Certifique-se de que o backend está rodando em http://localhost:3001'}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            )}
                            
                            {/* Hero Section */}
                            <div className="text-center mb-16">
                                <h1 className="text-5xl md:text-7xl font-bold text-gray-900 mb-6">
                                    Apresentações
                                    <span className="block text-transparent bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text">
                                        Extraordinárias
                                    </span>
                                    para Imóveis
                                </h1>
                                <p className="text-xl text-gray-600 max-w-3xl mx-auto">
                                    Transforme anúncios do Vila Vix Imóveis em apresentações profissionais 
                                    com dados completos, mapas interativos e análises de investimento.
                                </p>
                            </div>
                            
                            {/* Formulário */}
                            <div className="max-w-2xl mx-auto">
                                <div className="premium-card rounded-2xl p-8 transition-all">
                                    <form onSubmit={handleSubmit} className="space-y-6">
                                        <div>
                                            <label htmlFor="url" className="block text-sm font-medium text-gray-700 mb-2">
                                                URL do Imóvel (Vila Vix Imóveis)
                                            </label>
                                            <input
                                                type="text"
                                                id="url"
                                                value={url}
                                                onChange={(e) => setUrl(e.target.value)}
                                                placeholder="https://www.vilaviximoveis.com.br/imoveis/..."
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-purple-600 transition-all"
                                                disabled={isLoading}
                                            />
                                        </div>
                                        
                                        {error && (
                                            <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                                                {error}
                                            </div>
                                        )}
                                        
                                        <button
                                            type="submit"
                                            disabled={isLoading || apiStatus === 'offline'}
                                            className="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white font-semibold py-4 px-6 rounded-lg hover:from-purple-700 hover:to-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center"
                                        >
                                            {isLoading ? (
                                                <>
                                                    <div className="spinner mr-3"></div>
                                                    Processando imóvel...
                                                </>
                                            ) : (
                                                <>
                                                    <Icon name="search" className="w-5 h-5 mr-2" />
                                                    Gerar Apresentação
                                                </>
                                            )}
                                        </button>
                                    </form>
                                    
                                    <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                                        <p className="text-sm text-blue-800">
                                            <strong>Exemplo de URL válida:</strong><br />
                                            https://www.vilaviximoveis.com.br/imoveis/venda/vila-velha/...
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            {/* Features */}
                            <div className="grid md:grid-cols-3 gap-8 mt-20">
                                <div className="text-center">
                                    <div className="inline-flex p-4 bg-purple-100 rounded-full mb-4">
                                        <Icon name="search" className="w-8 h-8 text-purple-600" />
                                    </div>
                                    <h3 className="text-xl font-semibold mb-2">Extração Inteligente</h3>
                                    <p className="text-gray-600">Captura automática de dados, imagens e informações do imóvel</p>
                                </div>
                                <div className="text-center">
                                    <div className="inline-flex p-4 bg-blue-100 rounded-full mb-4">
                                        <Icon name="mapPin" className="w-8 h-8 text-blue-600" />
                                    </div>
                                    <h3 className="text-xl font-semibold mb-2">Análise de Localização</h3>
                                    <p className="text-gray-600">Mapa interativo com pontos de interesse próximos</p>
                                </div>
                                <div className="text-center">
                                    <div className="inline-flex p-4 bg-green-100 rounded-full mb-4">
                                        <Icon name="trendingUp" className="w-8 h-8 text-green-600" />
                                    </div>
                                    <h3 className="text-xl font-semibold mb-2">Projeção de Investimento</h3>
                                    <p className="text-gray-600">Análise de valorização e comparativo com SELIC</p>
                                </div>
                            </div>
                        </div>
                    </main>
                    
                    <Footer />
                </div>
            );
        };
        
        // ==================== COMPONENTES DA APRESENTAÇÃO ====================
        
        const PropertyDetails = ({ property }) => {
            const [selectedImage, setSelectedImage] = useState(0);
            
            return (
                <div className="space-y-8">
                    {/* Galeria de Imagens */}
                    <div className="grid lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-2">
                            <img
                                src={property.images[selectedImage]}
                                alt="Imagem principal"
                                className="w-full h-96 lg:h-[500px] object-cover rounded-lg shadow-lg"
                            />
                        </div>
                        <div className="space-y-4">
                            {property.images.slice(0, 4).map((image, index) => (
                                <img
                                    key={index}
                                    src={image}
                                    alt={`Imagem ${index + 1}`}
                                    className={`w-full h-24 object-cover rounded-lg cursor-pointer transition-all ${
                                        selectedImage === index ? 'ring-4 ring-purple-600' : 'hover:ring-2 hover:ring-purple-400'
                                    }`}
                                    onClick={() => setSelectedImage(index)}
                                />
                            ))}
                        </div>
                    </div>
                    
                    {/* Detalhes do Imóvel */}
                    <div className="grid md:grid-cols-4 gap-4">
                        {[
                            { icon: 'bed', value: property.bedrooms, label: 'Quartos' },
                            { icon: 'bath', value: property.bathrooms, label: 'Banheiros' },
                            { icon: 'area', value: property.area, label: 'm²' },
                            { icon: 'waves', value: property.beachDistance ? `${property.beachDistance}m` : 'N/A', label: 'da Praia' }
                        ].map((detail, index) => (
                            <div key={index} className="premium-card rounded-lg p-6 text-center transition-all">
                                <Icon name={detail.icon} className="w-8 h-8 text-purple-600 mx-auto mb-3" />
                                <div className="text-2xl font-bold text-gray-900">{detail.value}</div>
                                <div className="text-sm text-gray-600">{detail.label}</div>
                            </div>
                        ))}
                    </div>
                    
                    {/* Descrição */}
                    <div className="premium-card rounded-lg p-6 transition-all">
                        <h3 className="text-xl font-semibold mb-4">Descrição</h3>
                        <p className="text-gray-700 leading-relaxed whitespace-pre-line">{property.description || 'Descrição não disponível'}</p>
                    </div>
                    
                    {/* Características */}
                    <div className="premium-card rounded-lg p-6 transition-all">
                        <h3 className="text-xl font-semibold mb-4">Características</h3>
                        <div className="grid md:grid-cols-2 gap-3">
                            {property.features.map((feature, index) => (
                                <div key={index} className="flex items-center">
                                    <div className="w-2 h-2 bg-purple-600 rounded-full mr-3"></div>
                                    <span className="text-gray-700">{feature}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };
        
        const NearbyAmenities = ({ property }) => {
            const [selectedFilter, setSelectedFilter] = useState('Todos');
            
            const amenityTypes = ['Todos', ...new Set(property.amenities.map(a => a.type))];
            const filteredAmenities = selectedFilter === 'Todos' 
                ? property.amenities 
                : property.amenities.filter(a => a.type === selectedFilter);
            
            return (
                <div className="space-y-6">
                    {/* Header */}
                    <div className="premium-card rounded-lg p-6 bg-gradient-to-r from-purple-600 to-blue-600 text-white transition-all">
                        <h3 className="text-2xl font-semibold mb-2">Localização Premium</h3>
                        <p className="mb-1">📍 Bairro: {property.neighborhood}</p>
                        {property.beachDistance && (
                            <p>🏖️ Apenas {property.beachDistance}m da praia</p>
                        )}
                    </div>
                    
                    {/* Filtros */}
                    <div className="flex flex-wrap gap-2">
                        {amenityTypes.map(type => (
                            <button
                                key={type}
                                onClick={() => setSelectedFilter(type)}
                                className={`px-4 py-2 rounded-full text-sm font-medium transition-all ${
                                    selectedFilter === type
                                        ? 'bg-purple-600 text-white'
                                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                }`}
                            >
                                {type}
                            </button>
                        ))}
                    </div>
                    
                    {/* Lista de Amenidades */}
                    <div className="grid md:grid-cols-2 gap-4">
                        {filteredAmenities.map(amenity => (
                            <div key={amenity.id} className="premium-card rounded-lg p-4 transition-all">
                                <div className="flex items-start">
                                    <div className="text-2xl mr-3">{amenity.icon}</div>
                                    <div className="flex-1">
                                        <h4 className="font-semibold text-gray-900">{amenity.name}</h4>
                                        <p className="text-sm text-gray-600">{amenity.address}</p>
                                        <div className="flex justify-between items-center mt-2">
                                            <span className="text-xs bg-gray-100 text-gray-700 px-2 py-1 rounded">
                                                {amenity.type}
                                            </span>
                                            <span className="text-sm font-semibold text-purple-600">
                                                {amenity.distanceMeters ? 
                                                    (amenity.distanceMeters < 1000 ? 
                                                        `${amenity.distanceMeters}m` : 
                                                        `${(amenity.distanceMeters / 1000).toFixed(1)}km`)
                                                    : `${amenity.distance}km`
                                                }
                                            </span>
                                        </div>
                                        {amenity.rating && (
                                            <div className="mt-1 text-yellow-500 text-sm">
                                                {'★'.repeat(Math.round(amenity.rating))} {amenity.rating}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };
        
        const PropertyMap = ({ property }) => {
            const mapRef = useRef(null);
            const [mapError, setMapError] = useState(false);
            
            useEffect(() => {
                // Aguardar o Google Maps carregar
                const initMap = () => {
                    if (!window.google || !window.google.maps) {
                        setTimeout(initMap, 100);
                        return;
                    }
                    
                    try {
                        const map = new google.maps.Map(mapRef.current, {
                            center: { lat: property.latitude, lng: property.longitude },
                            zoom: 15,
                            styles: [
                                {
                                    featureType: "poi",
                                    elementType: "labels",
                                    stylers: [{ visibility: "off" }]
                                }
                            ]
                        });
                        
                        // Marcador principal do imóvel
                        new google.maps.Marker({
                            position: { lat: property.latitude, lng: property.longitude },
                            map,
                            title: property.title,
                            icon: {
                                url: 'https://maps.google.com/mapfiles/ms/icons/red-dot.png',
                                scaledSize: new google.maps.Size(40, 40)
                            }
                        });
                        
                        // Marcadores das amenidades
                        property.amenities.forEach(amenity => {
                            const marker = new google.maps.Marker({
                                position: { lat: amenity.latitude, lng: amenity.longitude },
                                map,
                                title: amenity.name,
                                icon: {
                                    url: 'https://maps.google.com/mapfiles/ms/icons/blue-dot.png',
                                    scaledSize: new google.maps.Size(30, 30)
                                }
                            });
                            
                            // InfoWindow
                            const infoWindow = new google.maps.InfoWindow({
                                content: `
                                    <div style="padding: 5px;">
                                        <strong>${amenity.name}</strong><br>
                                        <small>${amenity.type} - ${amenity.distance}km</small>
                                    </div>
                                `
                            });
                            
                            marker.addListener('click', () => {
                                infoWindow.open(map, marker);
                            });
                        });
                        
                    } catch (error) {
                        console.error('Erro ao carregar o mapa:', error);
                        setMapError(true);
                    }
                };
                
                initMap();
            }, [property]);
            
            if (mapError) {
                return (
                    <div className="premium-card rounded-lg p-12 text-center transition-all">
                        <Icon name="mapPin" className="w-12 h-12 text-gray-400 mx-auto mb-4" />
                        <p className="text-gray-600">Erro ao carregar o mapa</p>
                    </div>
                );
            }
            
            return (
                <div className="premium-card rounded-lg overflow-hidden transition-all">
                    <div className="h-96 lg:h-[500px]" ref={mapRef}></div>
                </div>
            );
        };
        
        const ValueProjection = ({ property }) => {
            const [appreciationRate, setAppreciationRate] = useState(5);
            const [selicRate, setSelicRate] = useState(11.75);
            
            useEffect(() => {
                propertyService.fetchSelicRate().then(setSelicRate);
            }, []);
            
            const calculateProjection = () => {
                const years = 5;
                const currentValue = property.price;
                const futureValue = currentValue * Math.pow(1 + appreciationRate / 100, years);
                const selicValue = currentValue * Math.pow(1 + selicRate / 100, years);
                const gain = futureValue - currentValue;
                const gainPercentage = ((futureValue - currentValue) / currentValue * 100);
                
                return {
                    currentValue,
                    futureValue,
                    selicValue,
                    gain,
                    gainPercentage,
                    years
                };
            };
            
            const projection = calculateProjection();
            
            return (
                <div className="space-y-8">
                    {/* Controle de Taxa */}
                    <div className="premium-card rounded-lg p-6 transition-all">
                        <h3 className="text-xl font-semibold mb-4">Taxa de Valorização Anual</h3>
                        <div className="flex items-center space-x-4">
                            <input
                                type="range"
                                min="1"
                                max="15"
                                step="0.5"
                                value={appreciationRate}
                                onChange={(e) => setAppreciationRate(parseFloat(e.target.value))}
                                className="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                            />
                            <span className="text-2xl font-bold text-purple-600 min-w-[80px] text-center">
                                {appreciationRate}%
                            </span>
                        </div>
                        <p className="text-sm text-gray-600 mt-2">
                            Taxa SELIC atual: <span className="font-semibold">{selicRate}% a.a.</span>
                        </p>
                    </div>
                    
                    {/* Estatísticas */}
                    <div className="grid md:grid-cols-3 gap-6">
                        <div className="premium-card rounded-lg p-6 text-center transition-all">
                            <Icon name="home" className="w-8 h-8 text-blue-600 mx-auto mb-3" />
                            <h4 className="text-sm text-gray-600 mb-2">Valor Atual</h4>
                            <p className="text-2xl font-bold text-gray-900">
                                R$ {projection.currentValue.toLocaleString('pt-BR')}
                            </p>
                        </div>
                        <div className="premium-card rounded-lg p-6 text-center transition-all">
                            <Icon name="trendingUp" className="w-8 h-8 text-green-600 mx-auto mb-3" />
                            <h4 className="text-sm text-gray-600 mb-2">Valor em 5 Anos</h4>
                            <p className="text-2xl font-bold text-gray-900">
                                R$ {projection.futureValue.toLocaleString('pt-BR')}
                            </p>
                            <p className="text-sm text-green-600 mt-1">
                                +{projection.gainPercentage.toFixed(1)}%
                            </p>
                        </div>
                        <div className="premium-card rounded-lg p-6 text-center transition-all">
                            <Icon name="eye" className="w-8 h-8 text-purple-600 mx-auto mb-3" />
                            <h4 className="text-sm text-gray-600 mb-2">vs. SELIC</h4>
                            <p className="text-2xl font-bold text-gray-900">
                                {projection.futureValue > projection.selicValue ? '+' : ''}
                                R$ {(projection.futureValue - projection.selicValue).toLocaleString('pt-BR')}
                            </p>
                            <p className={`text-sm mt-1 ${projection.futureValue > projection.selicValue ? 'text-green-600' : 'text-red-600'}`}>
                                {projection.futureValue > projection.selicValue ? 'Melhor que SELIC' : 'Pior que SELIC'}
                            </p>
                        </div>
                    </div>
                    
                    {/* Gráfico de Barras */}
                    <div className="premium-card rounded-lg p-6 transition-all">
                        <h3 className="text-xl font-semibold mb-6">Comparativo de Crescimento</h3>
                        <div className="space-y-4">
                            {Array.from({ length: 6 }, (_, year) => {
                                const propertyValue = property.price * Math.pow(1 + appreciationRate / 100, year);
                                const selicValue = property.price * Math.pow(1 + selicRate / 100, year);
                                const maxValue = Math.max(propertyValue, selicValue);
                                const propertyWidth = (propertyValue / maxValue) * 100;
                                const selicWidth = (selicValue / maxValue) * 100;
                                
                                return (
                                    <div key={year}>
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-sm font-medium text-gray-700">Ano {year}</span>
                                            <span className="text-sm text-gray-600">
                                                R$ {propertyValue.toLocaleString('pt-BR')}
                                            </span>
                                        </div>
                                        <div className="space-y-2">
                                            <div className="bg-gray-200 rounded-full h-3">
                                                <div 
                                                    className="bg-purple-600 h-3 rounded-full transition-all duration-500"
                                                    style={{ width: `${propertyWidth}%` }}
                                                ></div>
                                            </div>
                                            <div className="bg-gray-200 rounded-full h-2">
                                                <div 
                                                    className="bg-blue-600 h-2 rounded-full transition-all duration-500"
                                                    style={{ width: `${selicWidth}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                        <div className="flex justify-center space-x-6 mt-6">
                            <div className="flex items-center">
                                <div className="w-3 h-3 bg-purple-600 rounded-full mr-2"></div>
                                <span className="text-sm text-gray-700">Valorização do Imóvel</span>
                            </div>
                            <div className="flex items-center">
                                <div className="w-3 h-3 bg-blue-600 rounded-full mr-2"></div>
                                <span className="text-sm text-gray-700">Rendimento SELIC</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // ==================== PÁGINA DE APRESENTAÇÃO ====================
        
        const PresentationPage = ({ property, onNavigate }) => {
            const [activeTab, setActiveTab] = useState('overview');
            
            const tabs = [
                { id: 'overview', label: 'Visão Geral', icon: 'eye' },
                { id: 'neighborhood', label: 'Localização', icon: 'mapPin' },
                { id: 'projection', label: 'Investimento', icon: 'trendingUp' }
            ];
            
            const handleShare = () => {
                if (navigator.share) {
                    navigator.share({
                        title: property.title,
                        text: `Confira este imóvel: ${property.title}`,
                        url: window.location.href
                    });
                } else {
                    alert('Funcionalidade de compartilhamento em desenvolvimento!');
                }
            };
            
            const handleDownload = () => {
                alert('Download PDF será implementado em breve!');
            };
            
            return (
                <div className="min-h-screen bg-gray-50">
                    <Header />
                    
                    <main className="pt-24 pb-20">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            {/* Header da Apresentação */}
                            <div className="premium-card rounded-lg p-6 mb-8 transition-all">
                                <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                                    <div className="mb-4 lg:mb-0">
                                        <h1 className="text-3xl font-bold text-gray-900 mb-2">
                                            {property.title}
                                        </h1>
                                        <p className="text-lg text-gray-600 flex items-center">
                                            <Icon name="mapPin" className="w-5 h-5 mr-2 text-purple-600" />
                                            {property.address}
                                        </p>
                                        <p className="text-2xl font-bold text-green-600 mt-2">
                                            R$ {property.price.toLocaleString('pt-BR')}
                                        </p>
                                    </div>
                                    <div className="flex flex-wrap gap-3">
                                        <button
                                            onClick={() => onNavigate('home')}
                                            className="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center"
                                        >
                                            <Icon name="home" className="w-4 h-4 mr-2" />
                                            Voltar
                                        </button>
                                        <button
                                            onClick={handleShare}
                                            className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center"
                                        >
                                            <Icon name="share" className="w-4 h-4 mr-2" />
                                            Compartilhar
                                        </button>
                                        <button
                                            onClick={handleDownload}
                                            className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center"
                                        >
                                            <Icon name="download" className="w-4 h-4 mr-2" />
                                            Baixar PDF
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            {/* Navegação por Abas */}
                            <div className="premium-card rounded-lg mb-8 overflow-hidden">
                                <div className="flex">
                                    {tabs.map(tab => (
                                        <button
                                            key={tab.id}
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`flex-1 py-4 px-6 font-medium transition-all flex items-center justify-center ${
                                                activeTab === tab.id
                                                    ? 'bg-purple-600 text-white'
                                                    : 'text-gray-600 hover:bg-gray-50'
                                            }`}
                                        >
                                            <Icon name={tab.icon} className="w-5 h-5 mr-2" />
                                            {tab.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            
                            {/* Conteúdo das Abas */}
                            {activeTab === 'overview' && <PropertyDetails property={property} />}
                            {activeTab === 'neighborhood' && (
                                <div className="space-y-8">
                                    <NearbyAmenities property={property} />
                                    <PropertyMap property={property} />
                                </div>
                            )}
                            {activeTab === 'projection' && <ValueProjection property={property} />}
                        </div>
                    </main>
                    
                    <Footer />
                </div>
            );
        };
        
        // ==================== APLICAÇÃO PRINCIPAL ====================
        
        const App = () => {
            const [currentPage, setCurrentPage] = useState('home');
            const [propertyData, setPropertyData] = useState(null);
            
            const handleNavigate = (page, data = null) => {
                setCurrentPage(page);
                if (data) {
                    setPropertyData(data);
                }
            };
            
            return (
                <div>
                    {currentPage === 'home' && (
                        <HomePage onNavigate={handleNavigate} />
                    )}
                    {currentPage === 'presentation' && propertyData && (
                        <PresentationPage property={propertyData} onNavigate={handleNavigate} />
                    )}
                </div>
            );
        };
        
        // Renderização
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>